<!DOCTYPE HTML>
<html>
	<head>
		<title>Studia - Leaderboard</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="css/main.css" />
		<link rel="stylesheet" href="css/fontawesome-all.min.css" />
		<link rel="stylesheet" href="css/responsive.css" />
		<link rel="stylesheet" href="css/sidebar-fixed.css" />
		<link rel="stylesheet" href="css/menu-toggle.css" />
		<link rel="stylesheet" href="css/header-final.css?v=1749757770" />		<link rel="stylesheet" href="css/dark-mode.css" />
		<link rel="stylesheet" href="css/main-responsive.css" />		<style>
			/* Leaderboard Styles */
			.leaderboard-container {
				background: white;
				border-radius: 20px;
				padding: 40px;
				box-shadow: 0 10px 30px rgba(0,0,0,0.1);
				margin-bottom: 30px;
			}
			
			.leaderboard-header {
				text-align: center;
				margin-bottom: 40px;
			}
			
			.leaderboard-header h1 {
				color: #2c3e50;
				margin-bottom: 10px;
				font-size: 2.5em;
			}
			
			.leaderboard-header p {
				color: #6c757d;
				font-size: 1.1em;
			}
			
			/* Trophy Section */
			.trophy-section {
				display: flex;
				justify-content: center;
				gap: 30px;
				margin-bottom: 50px;
				flex-wrap: wrap;
			}
			
			.trophy-card {
				text-align: center;
				padding: 30px;
				border-radius: 15px;
				min-width: 200px;
				transition: transform 0.3s;
			}
			
			.trophy-card:hover {
				transform: translateY(-5px);
			}
			
			.trophy-gold {
				background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
				box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
			}
			
			.trophy-silver {
				background: linear-gradient(135deg, #C0C0C0 0%, #808080 100%);
				box-shadow: 0 5px 20px rgba(192, 192, 192, 0.3);
			}
			
			.trophy-bronze {
				background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
				box-shadow: 0 5px 20px rgba(205, 127, 50, 0.3);
			}
			
			.trophy-icon {
				font-size: 3em;
				color: white;
				margin-bottom: 15px;
			}
			
			.trophy-rank {
				font-size: 2em;
				font-weight: bold;
				color: white;
				margin-bottom: 10px;
			}
			
			.trophy-name {
				font-size: 1.2em;
				color: white;
				margin-bottom: 5px;
			}
			
			.trophy-score {
				font-size: 1.1em;
				color: rgba(255,255,255,0.9);
			}
			
			/* Leaderboard Table */
			.leaderboard-table {
				width: 100%;
				border-collapse: collapse;
				margin-top: 30px;
			}
			
			.leaderboard-table th {
				background: #f8f9fa;
				padding: 15px;
				text-align: left;
				font-weight: 600;
				color: #495057;
				border-bottom: 2px solid #dee2e6;
			}
			
			.leaderboard-table td {
				padding: 20px 15px;
				border-bottom: 1px solid #e9ecef;
			}
			
			.leaderboard-table tr:hover {
				background: #f8f9fa;
			}
			
			.rank-cell {
				font-weight: bold;
				color: #667eea;
				font-size: 1.2em;
			}
			
			.user-cell {
				display: flex;
				align-items: center;
				gap: 15px;
			}
			
			.user-avatar {
				width: 40px;
				height: 40px;
				border-radius: 50%;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				display: flex;
				align-items: center;
				justify-content: center;
				color: white;
				font-weight: bold;
				font-size: 1.2em;
			}
			
			.score-cell {
				font-weight: 600;
				color: #28a745;
			}
			
			.progress-cell {
				width: 150px;
			}
			
			.progress-bar-mini {
				width: 100%;
				height: 8px;
				background: #e9ecef;
				border-radius: 4px;
				overflow: hidden;
			}
			
			.progress-fill-mini {
				height: 100%;
				background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
			}
			
			/* My Rank Card */
			.my-rank-card {
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: white;
				padding: 30px;
				border-radius: 15px;
				margin-bottom: 40px;
				text-align: center;
				box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
			}
			
			.my-rank-card h3 {
				color: white;
				margin-bottom: 20px;
			}
			
			.my-rank-stats {
				display: flex;
				justify-content: space-around;
				flex-wrap: wrap;
				gap: 20px;
			}
			
			.stat-item {
				text-align: center;
			}
			
			.stat-value {
				font-size: 2em;
				font-weight: bold;
				margin-bottom: 5px;
			}
			
			.stat-label {
				font-size: 0.9em;
				opacity: 0.9;
			}
			
			/* Filter Tabs */
			.filter-tabs {
				display: flex;
				gap: 10px;
				margin-bottom: 30px;
				justify-content: center;
			}
			
			.filter-tab {
				padding: 10px 25px;
				border: 2px solid #e9ecef;
				background: white;
				border-radius: 25px;
				cursor: pointer;
				transition: all 0.3s;
				font-weight: 500;
			}
			
			.filter-tab:hover {
				border-color: #667eea;
			}
			
			.filter-tab.active {
				background: #667eea;
				color: white;
				border-color: #667eea;
			}
			
			/* Empty State */
			.empty-leaderboard {
				text-align: center;
				padding: 60px 20px;
				color: #6c757d;
			}
			
			.empty-leaderboard i {
				font-size: 4em;
				color: #dee2e6;
				margin-bottom: 20px;
			}
		</style>
	</head>
	<body class="is-preload">
		<!-- Menu Toggle Button -->
		<button class="menu-toggle-btn" onclick="toggleSidebar()">
			<i><span></span></i>
		</button>
		
		<!-- Wrapper -->
		<div id="wrapper">
			<!-- Main -->
			<div id="main">
				<div class="inner">
					                <!-- Header -->
                <header id="header">
                    <a href="index.html" class="logo">
                        <strong style="font-size: 2em;">Studia</strong>
                    </a>
                    <ul class="icons header-user-info">
                        <li><span id="userWelcome" data-username="">Welcome!</span></li>
                        <li><a href="#" onclick="logout()" class="button small logout-btn">Logout</a></li>
                    </ul>
                </header>

					<!-- Content -->
					<section>
						<div class="leaderboard-container">
							<div class="leaderboard-header">
								<h1><i class="fas fa-trophy"></i> Leaderboard</h1>
								<p>Compete with other students and track your progress</p>
							</div>

							<!-- Filter Tabs -->
							<div class="filter-tabs">
								<button class="filter-tab active" onclick="loadLeaderboard('global')">
									<i class="fas fa-globe"></i> Global
								</button>
								<button class="filter-tab" onclick="loadLeaderboard('weekly')">
									<i class="fas fa-calendar-week"></i> This Week
								</button>
								<button class="filter-tab" onclick="loadLeaderboard('monthly')">
									<i class="fas fa-calendar-alt"></i> This Month
								</button>
							</div>

							<!-- My Rank -->
							<div class="my-rank-card" id="myRankCard" style="display: none;">
								<h3>Your Current Ranking</h3>
								<div class="my-rank-stats" id="myRankStats">
									<!-- Will be populated by JS -->
								</div>
							</div>

							<!-- Top 3 Trophy Section -->
							<div class="trophy-section" id="trophySection">
								<!-- Will be populated by JS -->
							</div>

							<!-- Leaderboard Table -->
							<table class="leaderboard-table">
								<thead>
									<tr>
										<th style="width: 80px;">Rank</th>
										<th>Student</th>
										<th style="width: 120px;">Total Score</th>
										<th style="width: 100px;">Quizzes</th>
										<th style="width: 120px;">Average</th>
										<th style="width: 150px;">Progress</th>
									</tr>
								</thead>
								<tbody id="leaderboardBody">
									<!-- Will be populated by JS -->
								</tbody>
							</table>

							<!-- Empty State -->
							<div class="empty-leaderboard" id="emptyState" style="display: none;">
								<i class="fas fa-medal"></i>
								<h3>No rankings yet</h3>
								<p>Complete some quizzes to appear on the leaderboard!</p>
							</div>
						</div>
					</section>
				</div>
			</div>

			<!-- Sidebar -->
			<div id="sidebar">
				<div class="inner">
					<!-- Menu -->
					<nav id="menu">
						<header class="major">
							<h2>Menu</h2>
						</header>
						<ul>
							<li><a href="index.html">Main</a></li>
							<li><a href="summary.html">Summary</a></li>
							<li><a href="quiz.html">Quiz</a></li>
							<li><a href="plan.html">Study Plan</a></li>
							<li><a href="dashboard.html">Dashboard</a></li>
							<li><a href="leaderboard.html">Leaderboard</a></li>
							<li><a href="friends.html">Friends</a></li>
							<li><a href="profile.html">My Page</a></li>
						</ul>
					</nav>

					<!-- Section -->
					<section>
						<header class="major">
							<h2>Ranking Info</h2>
						</header>
						<p><strong>How Rankings Work:</strong></p>
						<ul style="font-size: 0.9em;">
							<li>Earn points by completing quizzes</li>
							<li>Higher scores = more points</li>
							<li>Consistency matters!</li>
						</ul>
					</section>

					<!-- Footer -->
					<footer id="footer"></footer>
				</div>
			</div>
		</div>

		<!-- Scripts -->
		<script src="js/jquery.min.js"></script>
		<script src="js/browser.min.js"></script>
		<script src="js/breakpoints.min.js"></script>
		<script src="js/util.js"></script>
		<script src="js/main.js"></script>
		<script src="assets/js/api.js"></script>
		<script src="js/header-username.js"></script>
		<script src="js/sidebar-toggle-global.js"></script>
		<script src="js/dark-mode.js"></script>
		<script src="js/sidebar-state.js"></script>

		<script>
			// Toggle Sidebar Function
			function toggleSidebar() {
				const sidebar = document.getElementById('sidebar');
				sidebar.classList.toggle('inactive');
				document.body.classList.toggle('sidebar-inactive');
			}
			
			let currentFilter = 'global';
			const API_BASE_URL = 'http://localhost:8080/api';

			// Page initialization
			document.addEventListener('DOMContentLoaded', async function() {
				// Set initial sidebar state - always start closed
				const sidebar = document.getElementById('sidebar');
				sidebar.classList.add('inactive');
				document.body.classList.add('sidebar-inactive');

				if (!checkAuth()) {
					alert('Please login first');
					window.location.href = '/';
					return;
				}

				updateHeader();
				await loadMyRank();
				await loadLeaderboard('global');
			});

			function updateHeader() {
                const username = TokenManager.getUsername();
                const userWelcome = document.getElementById('userWelcome');
                if (userWelcome) {
                    userWelcome.textContent = `Welcome, ${username || 'User'}!`;
                    userWelcome.setAttribute('data-username', username || 'User');
                }
            }!`;
            }!</span></li>
					<li><button class="button" onclick="logout()">Log Out</button></li>
				`;
			}

			function logout() {
				API.auth.logout();
			}

			async function loadMyRank() {
				try {
					const response = await fetch(`${API_BASE_URL}/leaderboard/my-rank`, {
						headers: {
							'Authorization': `Bearer ${TokenManager.getToken()}`
						}
					});
					
					if (!response.ok) throw new Error('Failed to load rank');
					
					const myRank = await response.json();
					displayMyRank(myRank);
				} catch (error) {
					console.error('Error loading my rank:', error);
				}
			}

			function displayMyRank(myRank) {
				const card = document.getElementById('myRankCard');
				const stats = document.getElementById('myRankStats');
				
				if (myRank.totalQuizzes === 0) {
					card.style.display = 'none';
					return;
				}
				
				card.style.display = 'block';
				stats.innerHTML = `
					<div class="stat-item">
						<div class="stat-value">#${myRank.rank || '-'}</div>
						<div class="stat-label">Current Rank</div>
					</div>
					<div class="stat-item">
						<div class="stat-value">${myRank.totalScore}</div>
						<div class="stat-label">Total Points</div>
					</div>
					<div class="stat-item">
						<div class="stat-value">${myRank.totalQuizzes}</div>
						<div class="stat-label">Quizzes Taken</div>
					</div>
					<div class="stat-item">
						<div class="stat-value">${myRank.averageScore.toFixed(1)}%</div>
						<div class="stat-label">Average Score</div>
					</div>
				`;
			}

			async function loadLeaderboard(filter) {
				currentFilter = filter;
				
				// Update active tab
				document.querySelectorAll('.filter-tab').forEach(tab => {
					tab.classList.remove('active');
				});
				event.target.classList.add('active');
				
				try {
					const response = await fetch(`${API_BASE_URL}/leaderboard/global?limit=20`, {
						headers: {
							'Authorization': `Bearer ${TokenManager.getToken()}`
						}
					});
					
					if (!response.ok) throw new Error('Failed to load leaderboard');
					
					const leaderboard = await response.json();
					displayLeaderboard(leaderboard);
				} catch (error) {
					console.error('Error loading leaderboard:', error);
					showEmptyState();
				}
			}

			function displayLeaderboard(leaderboard) {
				if (!leaderboard || leaderboard.length === 0) {
					showEmptyState();
					return;
				}
				
				document.getElementById('emptyState').style.display = 'none';
				
				// Display top 3 as trophies
				const trophySection = document.getElementById('trophySection');
				const top3 = leaderboard.slice(0, 3);
				
				trophySection.innerHTML = top3.map((user, index) => {
					const trophyClass = index === 0 ? 'trophy-gold' : index === 1 ? 'trophy-silver' : 'trophy-bronze';
					const icon = index === 0 ? 'fa-trophy' : index === 1 ? 'fa-medal' : 'fa-award';
					
					return `
						<div class="trophy-card ${trophyClass}">
							<i class="fas ${icon} trophy-icon"></i>
							<div class="trophy-rank">${index + 1}</div>
							<div class="trophy-name">${user.username}</div>
							<div class="trophy-score">${user.totalScore} points</div>
						</div>
					`;
				}).join('');
				
				// Display rest in table
				const tbody = document.getElementById('leaderboardBody');
				const tableData = leaderboard.slice(3);
				
				tbody.innerHTML = tableData.map((user, index) => {
					const rank = index + 4;
					const progressPercent = Math.min((user.totalScore / 1000) * 100, 100);
					
					return `
						<tr>
							<td class="rank-cell">#${rank}</td>
							<td>
								<div class="user-cell">
									<div class="user-avatar">${user.username.charAt(0).toUpperCase()}</div>
									<span>${user.username}</span>
								</div>
							</td>
							<td class="score-cell">${user.totalScore}</td>
							<td>${user.totalQuizzes}</td>
							<td>${user.averageScore.toFixed(1)}%</td>
							<td class="progress-cell">
								<div class="progress-bar-mini">
									<div class="progress-fill-mini" style="width: ${progressPercent}%"></div>
								</div>
							</td>
						</tr>
					`;
				}).join('');
			}

			function showEmptyState() {
				document.getElementById('trophySection').innerHTML = '';
				document.getElementById('leaderboardBody').innerHTML = '';
				document.getElementById('emptyState').style.display = 'block';
			}
		</script>
		</body>
</html>
